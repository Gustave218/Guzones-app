{% extends "base.html" %}
{% block content %}

<style>
body { background:#fff; margin:0; }

/* ===== IMAGE SLIDER ===== */
.product-slider {
  position: relative;
  width: 100%;
  overflow: hidden;
}

.slider-wrapper {
  display: flex;
  transition: transform 0.3s ease;
}

.slider-wrapper img {
  width: 100%;
  flex-shrink: 0;
  object-fit: cover;
}

/* image counter */
.image-counter {
  position: absolute;
  bottom: 12px;
  right: 12px;
  background: rgba(0,0,0,0.7);
  color:#fff;
  font-size:12px;
  padding:4px 10px;
  border-radius:20px;
}

/* ===== INFO ===== */
.product-info-box {
  padding:16px;
}

.product-title {
  font-size:18px;
  font-weight:600;
  margin-bottom:6px;
  line-height:1.4;
}

.product-price {
  font-size:22px;
  font-weight:800;
  margin-bottom:6px;
}

.product-meta {
  font-size:12px;
  color:#777;
  margin-bottom:14px;
}

.product-description {
  font-size:14px;
  color:#444;
  line-height:1.6;
}

/* ===== OPTIONS ===== */
.option-group {
  margin:18px 16px 0 16px;
}

.option-label {
  font-weight:600;
  display:block;
  margin-bottom:8px;
}

.option-values {
  display:flex;
  gap:10px;
  flex-wrap:wrap;
}

.option-item input {
  display:none;
}

.option-item span {
  display:inline-block;
  padding:6px 14px;
  border-radius:20px;
  border:1px solid #ddd;
  font-size:13px;
  cursor:pointer;
}

.option-item input:checked + span {
  background:#000;
  color:#fff;
  border-color:#000;
}

/* ===== STICKY CART ===== */
.sticky-cart {
  position:fixed;
  bottom:0;
  left:0;
  width:100%;
  background:#fff;
  padding:10px;
  display:flex;
  gap:10px;
  border-top:1px solid #eee;
  z-index:999;
}

.qty-box {
  display:flex;
  align-items:center;
  border:1px solid #ddd;
  border-radius:8px;
}

.qty-box button {
  width:35px;
  height:35px;
  border:none;
  background:#f5f5f5;
  font-size:18px;
}

.qty-box span {
  width:30px;
  text-align:center;
}

.btn-cart {
  flex:1;
  background:#000;
  color:#fff;
  border:none;
  border-radius:30px;
  font-weight:600;
}

.page-bottom-space {
  height:90px;
}
</style>


<!-- ===== IMAGE SLIDER ===== -->
<div class="product-slider">
  <div class="slider-wrapper" id="sliderWrapper">

    {% if product.images %}
      {% for img in product.images %}
        {% if img.image.startswith('http') %}
          <img src="{{ img.image }}">
        {% else %}
          <img src="{{ url_for('static', filename=img.image) }}">
        {% endif %}
      {% endfor %}
    {% else %}
      <img src="{{ url_for('static', filename='images/placeholder.png') }}">
    {% endif %}

  </div>

  <div class="image-counter">
    <span id="currentIndex">1</span> /
    <span>{{ product.images|length if product.images else 1 }}</span>
  </div>
</div>


<!-- ===== INFO ===== -->
<div class="product-info-box">

  <div class="product-title">
    {{ product.name_fr if g.lang == 'fr' else product.name_en }}
  </div>

  <div class="product-price">
    {{ product | money }}
  </div>

  <div class="product-meta">
    Guzones.com • Shipping all over Africa
  </div>

  <div class="product-description">
    {{ product.description_fr if g.lang == 'fr' else product.description_en }}
  </div>

</div>


<!-- ===== COLOR SELECTOR ===== -->
{% if product.colors %}
<div class="option-group">
  <span class="option-label">Color:</span>
  <div class="option-values">
    {% for color in product.colors.split(',') %}
      <label class="option-item">
        <input type="radio" name="color" value="{{ color.strip() }}">
        <span>{{ color.strip() }}</span>
      </label>
    {% endfor %}
  </div>
</div>
{% endif %}


<!-- ===== SIZE SELECTOR ===== -->
{% if product.sizes %}
<div class="option-group">
  <span class="option-label">Size:</span>
  <div class="option-values">
    {% for size in product.sizes.split(',') %}
      <label class="option-item">
        <input type="radio" name="size" value="{{ size.strip() }}">
        <span>{{ size.strip() }}</span>
      </label>
    {% endfor %}
  </div>
</div>
{% endif %}


<div class="page-bottom-space"></div>


<!-- ===== STICKY CART ===== -->
<div class="sticky-cart">

  <div class="qty-box">
    <button onclick="changeQty(-1)">−</button>
    <span id="qty">1</span>
    <button onclick="changeQty(1)">+</button>
  </div>

  <button class="btn-cart" onclick="addToCart()">
    {{ t.add_to_cart }}
  </button>

</div>



<script>
let current = 0;
const wrapper = document.getElementById("sliderWrapper");
const counter = document.getElementById("currentIndex");

if (wrapper) {
  let startX = 0;

  wrapper.addEventListener("touchstart", e => {
    startX = e.touches[0].clientX;
  });

  wrapper.addEventListener("touchend", e => {
    let endX = e.changedTouches[0].clientX;
    if (startX - endX > 50) next();
    if (endX - startX > 50) prev();
  });

  function next() {
    if (current < wrapper.children.length - 1) {
      current++;
      update();
    }
  }

  function prev() {
    if (current > 0) {
      current--;
      update();
    }
  }

  function update() {
    wrapper.style.transform = "translateX(-" + current * 100 + "%)";
    if (counter) counter.textContent = current + 1;
  }
}

let qty = 1;

function changeQty(val) {
  qty = Math.max(1, qty + val);
  document.getElementById("qty").textContent = qty;
}

function addToCart() {

  let colorInput = document.querySelector('input[name="color"]:checked');
  let sizeInput = document.querySelector('input[name="size"]:checked');

  {% if product.colors %}
  if (!colorInput) {
    alert("Please select a color");
    return;
  }
  {% endif %}

  {% if product.sizes %}
  if (!sizeInput) {
    alert("Please select a size");
    return;
  }
  {% endif %}

  let color = colorInput ? colorInput.value : "";
  let size = sizeInput ? sizeInput.value : "";

  window.location.href =
    "{{ url_for('add_to_cart', product_id=product.id) }}"
    + "?qty=" + qty
    + "&color=" + encodeURIComponent(color)
    + "&size=" + encodeURIComponent(size);
}
</script>

{% endblock %}