<div class="col">
    <div class="card h-100 shadow-sm border-0">

        <a href="{{ url_for('product_detail', product_id=product.id) }}">
            {% if product.image %}
                <img
                    src="{{ url_for('static', filename='uploads/' + product.image) }}"
                    class="card-img-top rounded-top"
                    style="height:220px; object-fit:cover;"
                >
            {% else %}
                <img
                    src="{{ url_for('static', filename='images/placeholder.png') }}"
                    class="card-img-top rounded-top"
                    style="height:220px; object-fit:cover;"
                >
            {% endif %}
        </a>

        <div class="card-body d-flex flex-column">
            <h6 class="fw-bold">{{ product.name_fr if g.lang == 'fr' else product.name_en }}</h6>

            <p class="text-muted small">
                {{ product.description_en[:70] }}{% if product.description_en|length > 70 %}...{% endif %}
            </p>

            <p class="fw-bold mt-auto">
                {{ product.price | int | format }} KES
            </p>

            <a href="{{ url_for('add_to_cart', product_id=product.id) }}"
               class="btn btn-dark w-100">
                {{ t.add_to_cart }}
            </a>
        </div>
    </div>
</div>

{# ===========================
   FAKE CONSISTENT PRODUCT META
   =========================== #}

{% set rating = (p.id % 3) + 3 %}
{% set reviews = (p.id * 13) % 240 + 12 %}
{% set has_discount = p.id % 4 == 0 %}
{% set in_stock = p.id % 5 != 0 %}

<a href="{{ url_for('product_detail', product_id=p.id) }}"
   class="related-link">

<div class="related-card">

    {% if has_discount %}
    <span class="discount-badge">-20%</span>
    {% endif %}

    {% if in_stock %}
    <span class="stock-badge in-stock">In stock</span>
    {% else %}
    <span class="stock-badge out-stock">Out of stock</span>
    {% endif %}

    <span class="wishlist-btn">♡</span>

    <div class="related-img">
        <img src="{{ url_for('static', filename='uploads/' + p.images[0].image) if p.images else url_for('static', filename='images/placeholder.png') }}">
    </div>

    <div class="related-body">

        <div class="rating">
            {% for i in range(rating) %}★{% endfor %}
            {% for i in range(5-rating) %}☆{% endfor %}
            <span>({{ reviews }})</span>
        </div>

        <p class="related-name">
            {{ p.name_fr if g.lang == 'fr' else p.name_en }}
        </p>

        <p class="related-price">
            {% if has_discount %}
            <span class="old-price">KES {{ "{:,.0f}".format(p.price * 1.25) }}</span>
            {% endif %}
            KES {{ "{:,.0f}".format(p.price) }}
        </p>

    </div>
</div>
</a>